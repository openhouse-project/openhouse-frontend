<script>
	import {
		makeChainStore,
		defaultChainStore,
		web3,
		connected,
		selectedAccount,
		chainId,
		chainData
	} from 'svelte-web3';

	//import { defaultChainStore, web3, selectedAccount, connected, chainId, chainData } from 'svelte-web3'
	export let name;
	let tipAddress = '0x834356a88C66897FA0A05a61964a91A607956ee3';
	let sokol, sokol_connected, sokol_web3;
	({ connected: sokol_connected, web3: sokol_web3, ...sokol } = makeChainStore('sokol'));
	sokol.setProvider('https://sokol.poa.network');
	const enable = () => defaultChainStore.setProvider('https://sokol.poa.network');
	const enableBrowser = () => defaultChainStore.setBrowserProvider();
	$: checkAccount = $selectedAccount || '0x0000000000000000000000000000000000000000';
	$: balance = $connected ? $web3.eth.getBalance(checkAccount) : '';
	const sendTip = async (e) => {
		console.log('Received move event (sendTip button)', e);
		const tx = await $web3.eth.sendTransaction({
			// gasPrice: $web3.utils.toHex($web3.utils.toWei('30', 'gwei')),
			gasLimit: $web3.utils.toHex('21000'),
			from: $selectedAccount,
			to: tipAddress,
			value: $web3.utils.toHex($web3.utils.toWei('1', 'finney'))
		});
		console.log('Receipt from sendTip transaction', tx);
		alert('Thanks!');
	};

</script>

<p>
	Simple example to use the default store. You may switch the connection to different providers
	(browser or not) at any time.
</p>

{#if $web3.version}
	<div class="buttons">
		<button class="btn btn-primary" on:click={enableBrowser}
			>connect to the browser window provider
		</button> (eg Metamask)
	</div>
{/if}

{#if $connected}
	<p>
		Connected chain: chainId = {$chainId}
	</p>
	<p>
		chainData = {JSON.stringify($chainData)}
	</p>
	<p>
		Selected account: {$selectedAccount || 'not defined'}
	</p>

	<p>
		{checkAccount} Balance on {$chainData.name}:
		{#await balance}
			<span>waiting...</span>
		{:then value}
			<span>{value}</span>
		{/await}
		{$chainData.nativeCurrency?.symbol}
	</p>
{/if}
